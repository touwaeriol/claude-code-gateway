# Claude Code Gateway

åŸºäº Claude Code SDK çš„ä¼ä¸šçº§ OpenAI å…¼å®¹ API ç½‘å…³æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„æƒé™æ§åˆ¶ã€å·¥å…·ç®¡ç†å’Œå®¡è®¡åŠŸèƒ½ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ”„ **å®Œå…¨å…¼å®¹ OpenAI API** - æ— ç¼æ›¿æ¢ç°æœ‰ OpenAI é›†æˆ
- ğŸš€ **åŸºäºå®˜æ–¹ Claude Code SDK** - ç¨³å®šå¯é çš„åº•å±‚å®ç°
- ğŸ” **ä¼ä¸šçº§æƒé™æ§åˆ¶** - ç»†ç²’åº¦çš„å·¥å…·è°ƒç”¨æƒé™ç®¡ç†
- ğŸ› ï¸ **MCP å·¥å…·ç½‘å…³** - æ”¯æŒè‡ªå®šä¹‰å·¥å…·æ‰©å±•
- ğŸ“Š **å®Œæ•´å®¡è®¡æ—¥å¿—** - æ‰€æœ‰æ“ä½œå¯è¿½æº¯
- ğŸŒŠ **æµå¼å“åº”æ”¯æŒ** - å®æ—¶è¾“å‡ºï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–
```bash
npm install
```

### å¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
# TypeScript ç›´æ¥è¿è¡Œ
npm run dev:ts

# æˆ–è€…ç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡å¯
npm run dev
```

### ç”Ÿäº§æ¨¡å¼
```bash
# æ„å»º TypeScript
npm run build

# è¿è¡Œæ„å»ºåçš„ JS
npm run start
```

## ğŸ” ä¼ä¸šçº§æƒé™æ§åˆ¶

### æ ¸å¿ƒå®‰å…¨æ¶æ„

æœ¬é¡¹ç›®å®ç°äº†å®Œæ•´çš„ä¼ä¸šçº§æƒé™æ§åˆ¶ç³»ç»Ÿï¼Œç¡®ä¿ AI å·¥å…·è°ƒç”¨çš„å®‰å…¨æ€§å’Œå¯æ§æ€§ï¼š

#### 1. å¤šå±‚å®‰å…¨é˜²æŠ¤
- **ç³»ç»Ÿçº§ç¦ç”¨**: é€šè¿‡ `disallowedTools` ç¦ç”¨æ‰€æœ‰å±é™©çš„å†…ç½®å·¥å…·
- **æƒé™ç½‘å…³**: å†…ç½® MCP æƒé™æœåŠ¡å™¨ï¼Œæ‹¦æˆªæ‰€æœ‰å·¥å…·è°ƒç”¨è¯·æ±‚
- **ä¼šè¯éš”ç¦»**: æ¯ä¸ª API è¯·æ±‚ç‹¬ç«‹ä¼šè¯ï¼Œæƒé™äº’ä¸å½±å“
- **å®¡è®¡è¿½è¸ª**: æ‰€æœ‰æƒé™æ£€æŸ¥å’Œå·¥å…·è°ƒç”¨å®Œæ•´è®°å½•

#### 2. MCP å·¥å…·ç½‘å…³æ¶æ„
```
Claude â†’ æƒé™æ£€æŸ¥(approval_prompt) â†’ å…è®¸/æ‹’ç» â†’ æ‰§è¡Œå·¥å…·
```
- ä½¿ç”¨ HTTP MCP åè®®ï¼Œæ”¯æŒåŠ¨æ€å·¥å…·æ³¨å†Œ
- æƒé™æœåŠ¡å™¨å®æ—¶éªŒè¯æ¯ä¸ªå·¥å…·è°ƒç”¨
- ç½‘å…³æœåŠ¡å™¨åªæš´éœ²æˆæƒçš„å·¥å…·

#### 3. ç»†ç²’åº¦æƒé™æ§åˆ¶
- **å·¥å…·çº§åˆ«**: ç²¾ç¡®æ§åˆ¶æ¯ä¸ªå·¥å…·çš„è®¿é—®æƒé™
- **å‚æ•°éªŒè¯**: éªŒè¯å·¥å…·è°ƒç”¨å‚æ•°çš„åˆæ³•æ€§
- **åŠ¨æ€æˆæƒ**: æ ¹æ®ä¼šè¯ä¸Šä¸‹æ–‡åŠ¨æ€è°ƒæ•´æƒé™

### æƒé™æ§åˆ¶ç¤ºä¾‹

```bash
# âœ… å®Œå…¨ç¦ç”¨å·¥å…· - ä¸æä¾›ä»»ä½•å·¥å…·
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "custom-claude-4-sonnet",
    "messages": [{"role": "user", "content": "è¯·è®¡ç®— 123 + 456 å¹¶è¯»å–æ–‡ä»¶"}],
    "tools": []
  }'
# ç»“æœï¼šClaude ä¸ä¼šå°è¯•è°ƒç”¨ä»»ä½•å·¥å…·ï¼Œåªèƒ½ç”¨æ–‡æœ¬å›å¤

# âœ… åªå…è®¸ç‰¹å®šå·¥å…·
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "custom-claude-4-sonnet", 
    "messages": [{"role": "user", "content": "è®¡ç®— 123 + 456"}],
    "tools": [{"type": "function", "function": {"name": "calculate", ...}}]
  }'
# ç»“æœï¼šClaude åªèƒ½è°ƒç”¨ calculate å·¥å…·ï¼Œæ— æ³•æ‰§è¡Œå…¶ä»–æ“ä½œ
```

### å®‰å…¨ä¿è¯

- âŒ **å†…ç½®å·¥å…·è¢«ç¦ç”¨**ï¼šClaude æ— æ³•è¯»å–æ–‡ä»¶ã€æ‰§è¡Œä»£ç ã€è®¿é—®ç½‘ç»œ
- âŒ **å¤–éƒ¨ MCP å·¥å…·è¢«ç¦ç”¨**ï¼šåªèƒ½ä½¿ç”¨æˆ‘ä»¬æ§åˆ¶çš„è™šæ‹Ÿ MCP æœåŠ¡å™¨
- âœ… **å®¢æˆ·ç«¯æ§åˆ¶æƒé™**ï¼šåªæœ‰å®¢æˆ·ç«¯æä¾›çš„å·¥å…·æ‰èƒ½è¢«ä½¿ç”¨
- âœ… **ä¼šè¯éš”ç¦»**ï¼šä¸åŒè¯·æ±‚ä¹‹é—´æƒé™å®Œå…¨ç‹¬ç«‹

### ğŸ›¡ï¸ å†…ç½®å·¥å…·

ç½‘å…³å†…ç½®äº†ä»¥ä¸‹å®‰å…¨çš„å·¥å…·ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©æ€§å¯ç”¨ï¼š

| å·¥å…·åç§° | åŠŸèƒ½æè¿° | å‚æ•° |
|---------|---------|------|
| `mcp__gateway__calculate` | æ•°å­¦è¡¨è¾¾å¼è®¡ç®— | `expression: string` |
| `mcp__gateway__search` | ä¿¡æ¯æœç´¢ï¼ˆæ¨¡æ‹Ÿï¼‰ | `query: string, limit?: number` |
| `mcp__gateway__get_weather` | å¤©æ°”æŸ¥è¯¢ï¼ˆæ¨¡æ‹Ÿï¼‰ | `location: string, units?: 'celsius'\|'fahrenheit'` |

### æµ‹è¯•æœåŠ¡
```bash
# åŸºæœ¬æµ‹è¯•
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "custom-claude-4-sonnet",
    "messages": [{"role": "user", "content": "ä½ å¥½"}]
  }'

# å·¥å…·è°ƒç”¨æµ‹è¯•
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "custom-claude-4-opus",
    "messages": [{"role": "user", "content": "è®¡ç®— 15 * 28"}],
    "tools": [{
      "type": "function",
      "function": {
        "name": "calculate",
        "description": "æ‰§è¡Œæ•°å­¦è®¡ç®—",
        "parameters": {
          "type": "object",
          "properties": {
            "expression": {"type": "string"}
          },
          "required": ["expression"]
        }
      }
    }]
  }'
```

## ğŸ§ª æµ‹è¯•æœåŠ¡

```bash
# åŸºæœ¬å¯¹è¯æµ‹è¯•
curl -X POST http://localhost:3000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "custom-claude-4-sonnet",
    "messages": [{"role": "user", "content": "ä½ å¥½"}]
  }'

# æŸ¥çœ‹æ›´å¤šç¤ºä¾‹
ls examples/
```

## ğŸ“‹ æ”¯æŒçš„æ¨¡å‹

- `custom-claude-4-sonnet` - Claude Sonnet 4
- `custom-claude-4-opus` - Claude Opus 4

## ğŸ› ï¸ å®¢æˆ·ç«¯ä½¿ç”¨

### Python
```python
from openai import OpenAI

client = OpenAI(
    base_url="http://localhost:3000/v1",
    api_key="any-value"  # å¯ä»¥æ˜¯ä»»æ„å€¼
)

response = client.chat.completions.create(
    model="custom-claude-4-sonnet",
    messages=[{"role": "user", "content": "ä½ å¥½"}]
)
```

### JavaScript/TypeScript
```typescript
import OpenAI from 'openai';

const openai = new OpenAI({
    baseURL: 'http://localhost:3000/v1',
    apiKey: 'any-value'
});

const response = await openai.chat.completions.create({
    model: 'custom-claude-4-sonnet',
    messages: [{ role: 'user', content: 'ä½ å¥½' }]
});
```

## âœ… åŠŸèƒ½ç‰¹æ€§

### å¼€å‘ä½“éªŒ
- ğŸ¯ **TypeScript åŸç”Ÿ** - å®Œæ•´ç±»å‹æ”¯æŒï¼Œä¼˜ç§€çš„ IDE ä½“éªŒ
- ğŸ”¥ **çƒ­é‡è½½å¼€å‘** - æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡å¯
- ğŸ“¦ **ç”Ÿäº§æ„å»º** - æ”¯æŒç¼–è¯‘ä¼˜åŒ–éƒ¨ç½²

### API å…¼å®¹æ€§
- ğŸ”„ **OpenAI å®Œå…¨å…¼å®¹** - æ”¯æŒæ‰€æœ‰ä¸»æµ OpenAI å®¢æˆ·ç«¯
- ğŸŒŠ **æµå¼å“åº”** - å®æ—¶è¾“å‡ºï¼Œæ”¯æŒ SSE
- ğŸ› ï¸ **å·¥å…·è°ƒç”¨** - å®Œæ•´çš„ Function Calling æ”¯æŒ

### ä¼ä¸šç‰¹æ€§
- ğŸ” **æƒé™ç®¡ç†** - åŸºäºä¼šè¯çš„ç»†ç²’åº¦æ§åˆ¶
- ğŸ“Š **å®¡è®¡æ—¥å¿—** - ç¬¦åˆåˆè§„è¦æ±‚çš„æ—¥å¿—è®°å½•
- ğŸš¦ **é€Ÿç‡é™åˆ¶** - ä¿æŠ¤åç«¯èµ„æºï¼ˆå¯æ‰©å±•ï¼‰
- ğŸ”Œ **æ’ä»¶ç³»ç»Ÿ** - æ˜“äºæ‰©å±•æ–°å·¥å…·

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI Client  â”‚â”€â”€â”€â”€â–¶â”‚    Claude Code Gateway       â”‚â”€â”€â”€â”€â–¶â”‚  Claude Code    â”‚
â”‚  (Python/JS/...)â”‚     â”‚                              â”‚     â”‚      SDK        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚  â”‚   Permission Control    â”‚ â”‚
                        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                        â”‚  â”‚   MCP Tool Gateway     â”‚ â”‚
                        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                        â”‚  â”‚   Session Manager      â”‚ â”‚
                        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                        â”‚  â”‚   Audit Logger         â”‚ â”‚
                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰
```bash
# æ„å»ºé•œåƒ
docker build -t claude-gateway .

# è¿è¡Œå®¹å™¨
docker run -p 3000:3000 \
  -e ANTHROPIC_API_KEY=your-key \
  -e CORS_ORIGIN="*" \
  claude-gateway
```

### PM2 éƒ¨ç½²
```bash
# å®‰è£… PM2
npm install -g pm2

# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨æœåŠ¡
pm2 start dist/index.js --name claude-gateway

# æŸ¥çœ‹æ—¥å¿—
pm2 logs claude-gateway
```

### ç¯å¢ƒå˜é‡
- `PORT` - æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤: 3000ï¼‰
- `CORS_ORIGIN` - CORS å…è®¸çš„åŸŸåï¼ˆé»˜è®¤: *ï¼‰
- `LOG_LEVEL` - æ—¥å¿—çº§åˆ«ï¼ˆé»˜è®¤: infoï¼‰
- `SESSION_TIMEOUT` - ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤: 5åˆ†é’Ÿï¼‰

## ğŸ“– å¼€å‘æŒ‡å—

```bash
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿è¡Œç”Ÿäº§ç‰ˆæœ¬
npm run start
```

## ğŸ“– API æ–‡æ¡£

### OpenAI å…¼å®¹ç«¯ç‚¹
- `GET /v1/models` - è·å–æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨
- `GET /v1/models/:id` - è·å–æ¨¡å‹è¯¦æƒ…
- `POST /v1/chat/completions` - åˆ›å»ºèŠå¤©å®Œæˆ

### ç®¡ç†ç«¯ç‚¹
- `GET /health` - å¥åº·æ£€æŸ¥å’Œç³»ç»ŸçŠ¶æ€
- `POST /mcp/permission/check` - æƒé™éªŒè¯ç«¯ç‚¹
- `POST /mcp/gateway/:tool` - å·¥å…·æ‰§è¡Œç«¯ç‚¹

### MCP åè®®ç«¯ç‚¹
- `POST /mcp/permission` - MCP æƒé™æœåŠ¡å™¨
- `POST /mcp/gateway` - MCP ç½‘å…³æœåŠ¡å™¨

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### ç”Ÿäº§ç¯å¢ƒå»ºè®®
1. **API è®¤è¯**: å®ç°çœŸå®çš„ API Key éªŒè¯
2. **HTTPS**: ä½¿ç”¨ TLS åŠ å¯†æ‰€æœ‰é€šä¿¡
3. **é€Ÿç‡é™åˆ¶**: é˜²æ­¢æ»¥ç”¨å’Œ DDoS
4. **æ—¥å¿—ç®¡ç†**: ä½¿ç”¨ä¸“ä¸šæ—¥å¿—ç³»ç»Ÿï¼ˆå¦‚ ELKï¼‰
5. **ç›‘æ§å‘Šè­¦**: é›†æˆç›‘æ§ç³»ç»Ÿï¼ˆå¦‚ Prometheusï¼‰

### æƒé™é…ç½®å»ºè®®
- æœ€å°æƒé™åŸåˆ™ï¼šåªæˆäºˆå¿…è¦çš„å·¥å…·æƒé™
- å®šæœŸå®¡è®¡ï¼šæ£€æŸ¥æƒé™ä½¿ç”¨æƒ…å†µ
- å·¥å…·ç™½åå•ï¼šæ˜ç¡®å®šä¹‰å¯ç”¨å·¥å…·é›†

## ğŸ“š æ–‡æ¡£

- [é¡¹ç›®æ¦‚è¿°](./docs/OVERVIEW.md) - è¯¦ç»†ä»‹ç»å’Œä½¿ç”¨åœºæ™¯
- [æ¶æ„è®¾è®¡](./docs/ARCHITECTURE.md) - ç³»ç»Ÿæ¶æ„å’ŒæŠ€æœ¯è®¾è®¡
- [å®‰å…¨æŒ‡å—](./docs/SECURITY.md) - æƒé™æ§åˆ¶å’Œå®‰å…¨å®è·µ
- [SDK å‚è€ƒ](./docs/CLAUDE_CODE_SDK.md) - Claude Code SDK ä½¿ç”¨æŒ‡å—
- [ç¤ºä¾‹ä»£ç ](./examples/README.md) - å„ç§è¯­è¨€çš„é›†æˆç¤ºä¾‹

## ğŸ“„ è®¸å¯è¯

MIT